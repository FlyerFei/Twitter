<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Tweet it Better!</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
        <style>
        #tweetbox {
			position:relative;
		    top: 35%;
		    left: 35%;
		    height: 250px;
        }
/*        textarea {   
	    	width: 400px;  
	    	max-width: 400px;  
	    	height: 150px;  
	    	line-height: 150%; 

	    	padding: 9px;  
		    border: solid 1px #E5E5E5;  
		    outline: 0;  
		    font: normal 13px/100% Verdana, Tahoma, sans-serif;  
		    background: #FFFFFF;   
	    }  */

	    textarea {   
		    padding: 9px;  
		    border: solid 1px #E5E5E5;  
		    outline: 0;  
		    font: normal 13px/100% Verdana, Tahoma, sans-serif;  
		    width: 200px;  

		    background: -webkit-gradient(linear, left top, left 25, from(#FFFFFF), color-stop(4%, #EEEEEE), to(#FFFFFF));  
		    background: -moz-linear-gradient(top, #FFFFFF, #EEEEEE 1px, #FFFFFF 25px);  
		    box-shadow: rgba(0,0,0, 0.1) 0px 0px 8px;  
		    -moz-box-shadow: rgba(0,0,0, 0.1) 0px 0px 8px;  
		    -webkit-box-shadow: rgba(0,0,0, 0.1) 0px 0px 8px;  
	    }  

	    textarea {   
		    width: 400px;  
		    max-width: 400px;  
		    height: 150px;  
		    line-height: 150%;  
	    }  
  
		input:hover, textarea:hover,  
		input:focus, textarea:focus {   
		    border-color: #C9C9C9;   
		    -webkit-box-shadow: rgba(0, 0, 0, 0.15) 0px 0px 8px;  
		    } 

		.normal_button {
			position: absolute;
    		bottom: 0;
		    left: 0;
		}

		body {
			background-image:url('./resources/bg.jpg');
			background-color: white;
			background-size: cover;
			font-family: impact;
		}
		#tweetbox h2 {
	color: #FFF;
}
        </style>
    </head>
    
    <script type="text/javascript" src="https://www.dropbox.com/static/api/1/dropins.js" id="dropboxjs" data-app-key="ng05wv2uvviksqo"></script>
    </script>

    <body>
    <div id = "tweetbox">
      <h2>Tweet here!</h2>
    	 	<textarea maxlength="140" name="tweet" id = "tweet"></textarea> 	
 	  <img src='./resources/location1.png' class='normal_button' id='map_button'>

    	 	<div class='normal_button' style='left:50px'>
    	 		<input type="dropbox-chooser" data-extensions=".png .jpg .gif" name="selected-file" id="db-chooser"/>
    	 	</div>
    	 </div>
    
    
<script type="text/javascript">
    var query_search;
    var special_key_map;

    chooser_options = {
        // Required. Called when a user selects an item in the Chooser.
        success: function(files) {
			var str = $('#tweet').val();
		    str = str.replace ('`^', files[0].link);
		    $('#tweet').val(str);
        },
        linkType: "preview",
        multiselect: false,
        extensions: ['.png', '.jpg', '.gif'],
    };

     function HandleMapResult(lat,lng) {
	    alert("location: " + lat + ", " +lng );
	}
	function HandleSearchResult(searchResult, lat,lng) {
	    var str = $('#tweet').val();
	    str = str.replace ('`!'+special_key_map+' ', '#'+searchResult);
	    $('#tweet').val(str);
	}

		$(document).ready(function () {
	       $('#tweet').keyup(function () {
				var tweet_text = $('#tweet').val();
				//search for special keys
				// 1. map (`!)
				if (tweet_text.match(/`\!([A-Za-z0-9 ]+)\s{2}/)) {
					special_key_map = tweet_text.match(/`\!([A-Za-z0-9 ]+)\s{2}/)[1];
					query_search=special_key_map;	
					window.open('./map/map_search.html','targetWindow','location=0,menubar=0,status=0,scrollbars=0,width=400,height=400');
				}

				// 2. dropbox - upload (`^)
				if (tweet_text.match(/`\^([^ ]*)/)) {
					Dropbox.choose(chooser_options);
				}
	        });
	       $('#map_button').click(function () {	
	       		window.open('./map/map.html','targetWindow','location=0,menubar=0,status=0,scrollbars=0,width=400,height=400')
	       });
		});
    </script>
    
    </body>
</html>